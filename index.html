
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Code Gangsta</title>
  <meta name="author" content="Jeremy">

  
  <meta name="description" content="Code Gangsta Rants and raves from a certified G. Jul 21st, 2013 Comments cli go golang ruby On Distributing Command line Applications: Why I &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://codegangsta.io">
  <link href="/favicon.png" rel="icon">
  <link href='http://fonts.googleapis.com/css?family=Quicksand:300,400' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300' rel='stylesheet' type='text/css'>
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Code Gangsta" type="application/atom+xml">
  <script src="/js/jquery.js"></script>
  <script src="/js/bootstrap-collapse.js"></script>
  <script src="/js/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/js/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <div class="navbar navbar-inverse navbar-static-top">
  	<div class="navbar-inner">
  	  <div class="container">
        <a class="btn btn-navbar" data-toggle="collapse" data-target=".navbar-responsive-collapse">
          <span class="fui-menu-24"></span>
        </a>
  	  	<div class="nav-collapse collapse navbar-responsive-collapse" style="height:0;">
  	      <ul class="nav">
    
</ul>

<ul class="nav pull-right">
    
    <li><a href="http://github.com/codegangsta" title="Github Profile"><i class="icon-github-sign social-navbar"></i></a></li>
    
    
    
    <li><a href="http://twitter.com/codegangsta" title="Twitter Profile"><i class="icon-twitter-sign social-navbar"></i></a></li>
    
    
    
</ul>

  	    </div>
  	  </div>
  	</div>
  </div>
  <div class="container" id="main">
    <div class="span12">
      <div class="row-fluid">
        <div id="content">
          <div class="jumbotron">
  <div class="container">
    Code Gangsta
    <h3 class="tagline">Rants and raves from a certified G.</h3>
  </div>
</div>


<div class="blog-index">
  
  
  
    <article>
      

  <div class="row-fluid">
    <div class="span2">
		<h1 class="date-time">








  


<i class="icon-calendar-empty"></i> <time datetime="2013-07-21T14:24:00-07:00" pubdate data-updated="true">Jul 21<span>st</span>, 2013</time></h5>
          <div class="row-fluid">
          
          <a href="http://codegangsta.io/blog/2013/07/21/creating-cli-applications-in-go/#disqus_thread">Comments </a> <span class="fui-bubble-16"></span>
          
          </div>
          
          <div class="row-fluid">
          
          <a href="/blog/categories/cli/"><span class="badge">cli</span></a>
          
          <a href="/blog/categories/go/"><span class="badge">go</span></a>
          
          <a href="/blog/categories/golang/"><span class="badge">golang</span></a>
          
          <a href="/blog/categories/ruby/"><span class="badge">ruby</span></a>
          
          </div>
          
    </div>
    <div class="span10">
      <h1 class="link"><a href="/blog/2013/07/21/creating-cli-applications-in-go/">On Distributing Command line Applications: Why I switched from Ruby to Go</a></h1>
      <p>For as long as I have been using it, my go-to language for creating CLI applications was Ruby. After all, Ruby is a robust, mature language with many things to make us developers want to gyrate with joy (okay maybe that is just me).</p>

<p>To this day I still hold the opinion that Ruby provides the most elegant amount of expression when it comes to my everyday programming activities. Whether it is the language or the community that fosters clean code, I feel like an artisan every time I sit down to write an application or library in Ruby.</p>

<p>There is something so elegant and beautiful about creating a command line application with the following code:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">desc</span> <span class="s2">&quot;A todo application&quot;</span>
</span><span class='line'><span class="n">app</span> <span class="ss">:todo</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">desc</span> <span class="s2">&quot;add a todo&quot;</span>
</span><span class='line'>  <span class="n">command</span> <span class="ss">:add</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s2">&quot;Your todo has been added&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="n">desc</span> <span class="s2">&quot;remove a todo&quot;</span>
</span><span class='line'>  <span class="n">command</span> <span class="ss">:remove</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s2">&quot;your todo has been removed&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Distributing Ruby</h2>

<p>While the code is beautiful, distributing Ruby programs is not. Now - I don&#8217;t want to make you believe that program distribution should be an easy thing, because it definitely is not. There are so many things that can possibly go wrong with an application when you expect it to leave your programming and test environments to run perfectly on your end users machines. Let me say it again; <em>Distributing programs is <strong>hard work!</strong></em></p>

<p>I&#8217;m sure you are thinking, &#8220;Why not distribute your app via Rubygems?&#8221;. After attempting the distribution of a command line application via Rubygems I came to the following conclusion: <strong>Any application not intended exclusively for Rubyists should not be distributed via Rubygems.</strong> Luckily <a href="http://mitchellh.com/abandoning-rubygems">I am not the only one</a> who holds this position on distribution, so that leads those of us that wish to use Ruby on a long road to properly distribute a command line application.</p>

<h2>Custom Ruby and Vendoring</h2>

<p>The next natural option with Ruby would be to distribute your entire application independent of RubyGems. So you <em>really</em> only have one good option here, and that is to <a href="http://yehudakatz.com/2012/06/05/tokaido-status-update-implementation-details/">compile a custom version of Ruby</a> to distribute with each OS installer (Yes, you must have an installer) of your application. Just so you don&#8217;t mess with a users current installation you must compile under a custom prefix; something along the lines of <code>/usr/local/&lt;yourapp&gt;/ruby</code>.</p>

<p>Once this is done it is important to make sure you vendor and distribute all of your gems that you use for your application. This can get nasty when it comes to native gems that rely on local dynamic libraries. Anyway, I hope you get the picture that <em>distributing a ruby app to end users can be a hassle.</em></p>

<h2>Building it in Go</h2>

<p>If you are adventurous you have probably played with, or heard of the <a href="http://golang.org/">Go programming language</a>. In fact I have started to blog about it for the past couple of weeks. My recent love affair with Go has led me to believe that distributing applications to end users in Go is a much simpler process than languages like Ruby.</p>

<p>Since Go is a compiled language, binaries of your app can be precompiled for each platform that you wish to distribute for. While not as portable as C, (and who can be, C compilers are everywhere!) Go provides a lightweight set of tools that can compile on many platforms for those who wish their end users to compile from source.</p>

<h2>Introducing cli.go</h2>

<p>While I loved the simplicity in distributing an application in Go, I missed that expressiveness that I got from Ruby, so (shameless plug) I rolled my own CLI library called <a href="https://github.com/codegangsta/cli">cli.go</a>.</p>

<p><a href="https://github.com/codegangsta/cli">cli.go</a> provides that expressive, &#8220;Document as you code&#8221; model for building command line applications in Go. It is easily distributable and super fast! Building real command line apps is as easy as this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='go'><span class='line'><span class="kn">package</span> <span class="nx">main</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="s">&quot;os&quot;</span>
</span><span class='line'><span class="kn">import</span> <span class="s">&quot;github.com/codegangsta/cli&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">app</span> <span class="o">:=</span> <span class="nx">cli</span><span class="p">.</span><span class="nx">NewApp</span><span class="p">()</span>
</span><span class='line'>  <span class="nx">app</span><span class="p">.</span><span class="nx">Name</span> <span class="p">=</span> <span class="s">&quot;boom&quot;</span>
</span><span class='line'>  <span class="nx">app</span><span class="p">.</span><span class="nx">Usage</span> <span class="p">=</span> <span class="s">&quot;make an explosive entrance&quot;</span>
</span><span class='line'>  <span class="nx">app</span><span class="p">.</span><span class="nx">Action</span> <span class="p">=</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">cli</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nb">println</span><span class="p">(</span><span class="s">&quot;boom! I say!&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">app</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Go check out the <a href="https://github.com/codegangsta/cli">cli.go</a> repo. <strong>Star</strong> it, <strong>fork</strong> it, <strong>Contribute</strong> to it. Let&#8217;s make Go the go-to language for command line tools!</p>

<p>Keep writing beautiful code.</p>

      
      
    </div>
  </div>



    </article>
    
    <hr>
    
  
  
    <article>
      

  <div class="row-fluid">
    <div class="span2">
		<h1 class="date-time">








  


<i class="icon-calendar-empty"></i> <time datetime="2013-07-11T07:42:00-07:00" pubdate data-updated="true">Jul 11<span>th</span>, 2013</time></h5>
          <div class="row-fluid">
          
          <a href="http://codegangsta.io/blog/2013/07/11/practical-go-build-tags/#disqus_thread">Comments </a> <span class="fui-bubble-16"></span>
          
          </div>
          
          <div class="row-fluid">
          
          <a href="/blog/categories/buildtags/"><span class="badge">buildtags</span></a>
          
          <a href="/blog/categories/cgo/"><span class="badge">cgo</span></a>
          
          <a href="/blog/categories/go/"><span class="badge">go</span></a>
          
          <a href="/blog/categories/golang/"><span class="badge">golang</span></a>
          
          <a href="/blog/categories/libmockspotify/"><span class="badge">libmockspotify</span></a>
          
          <a href="/blog/categories/libspotify/"><span class="badge">libspotify</span></a>
          
          <a href="/blog/categories/practicalgo/"><span class="badge">practicalgo</span></a>
          
          <a href="/blog/categories/spotify/"><span class="badge">spotify</span></a>
          
          </div>
          
    </div>
    <div class="span10">
      <h1 class="link"><a href="/blog/2013/07/11/practical-go-build-tags/">Practical Go: Build Tags</a></h1>
      <p>In our <a href="blog/2013/07/08/c-bindings-in-go-a-practical-example/">last post</a> we wrote a simple set of bindings for libspotify in Go. By the end of the post we had an example compiling, but we had a bad API key for our spotify application. One obvious way to recify this would be to grab an API key if you are a Spotfy Premium user. Another workaround is to use a <em>mock</em> library to make sure the code is working the way we want. We will link this mock library with <strong>Build tags.</strong></p>

<h2>Mocking Spotify</h2>

<p>Start by installing libmockspotify:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>git clone git@github.com:mopidy/libmockspotify.git
</span><span class='line'>cd libmockspotify
</span><span class='line'>./autogen.sh
</span><span class='line'>./configure
</span><span class='line'>make
</span><span class='line'>sudo make install
</span></code></pre></td></tr></table></div></figure>


<p>Once libmockspotify is installed, we can link to that instead of the real libspotify:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='go'><span class='line'><span class="kn">package</span> <span class="nx">main</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm">#include &lt;libspotify/api.h&gt;</span>
</span><span class='line'><span class="cm">#cgo LDFLAGS: -lmockspotify.2</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="kn">import</span> <span class="s">&quot;C&quot;</span>
</span><span class='line'><span class="kn">import</span> <span class="s">&quot;unsafe&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">type</span> <span class="nx">Session</span> <span class="kd">struct</span> <span class="p">{</span>
</span><span class='line'><span class="nx">session</span> <span class="o">*</span><span class="nx">C</span><span class="p">.</span><span class="nx">sp_session</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'><span class="nx">key</span> <span class="o">:=</span> <span class="s">&quot;appkey_good&quot;</span>
</span><span class='line'><span class="nx">session</span> <span class="o">:=</span> <span class="nx">Session</span><span class="p">{}</span>
</span><span class='line'>  <span class="nx">appkey</span> <span class="o">:=</span> <span class="nx">C</span><span class="p">.</span><span class="nx">CString</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span>
</span><span class='line'>  <span class="nx">appkey_size</span> <span class="o">:=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">config</span> <span class="p">=</span> <span class="nx">C</span><span class="p">.</span><span class="nx">sp_session_config</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">api_version</span><span class="p">:</span>          <span class="nx">C</span><span class="p">.</span><span class="nx">SPOTIFY_API_VERSION</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">cache_location</span><span class="p">:</span>       <span class="nx">C</span><span class="p">.</span><span class="nx">CString</span><span class="p">(</span><span class="s">&quot;.spotify/&quot;</span><span class="p">),</span>
</span><span class='line'>    <span class="nx">settings_location</span><span class="p">:</span>    <span class="nx">C</span><span class="p">.</span><span class="nx">CString</span><span class="p">(</span><span class="s">&quot;.spotify/&quot;</span><span class="p">),</span>
</span><span class='line'>    <span class="nx">user_agent</span><span class="p">:</span>           <span class="nx">C</span><span class="p">.</span><span class="nx">CString</span><span class="p">(</span><span class="s">&quot;spotify for go&quot;</span><span class="p">),</span>
</span><span class='line'>    <span class="nx">application_key</span><span class="p">:</span>      <span class="nx">unsafe</span><span class="p">.</span><span class="nx">Pointer</span><span class="p">(</span><span class="nx">appkey</span><span class="p">),</span>
</span><span class='line'>    <span class="nx">application_key_size</span><span class="p">:</span> <span class="nx">C</span><span class="p">.</span><span class="nx">size_t</span><span class="p">(</span><span class="nx">appkey_size</span><span class="p">)}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">C</span><span class="p">.</span><span class="nx">sp_session_create</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">config</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">session</span><span class="p">.</span><span class="nx">session</span><span class="p">)</span>
</span><span class='line'>  <span class="nb">println</span><span class="p">(</span><span class="s">&quot;Session created!&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The following code should output:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>Session created!
</span></code></pre></td></tr></table></div></figure>


<h2>Using build tags</h2>

<p>It&#8217;s great that we have libmockspotify for testing purposes, but it doesn&#8217;t make sense to always mock spotify in our project. This is where <strong>Build Tags</strong> come into play. We can use build tags to conditionally choose which library to link to.</p>

<p>Let&#8217;s link both libspotify and libmockspotify in our file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='go'><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm">#include &lt;libspotify/api.h&gt;</span>
</span><span class='line'><span class="cm">#cgo LDFLAGS: -lmockspotify.2</span>
</span><span class='line'><span class="cm">#cgo LDFLAGS: -lspotify.12</span>
</span><span class='line'><span class="cm">*/</span>
</span></code></pre></td></tr></table></div></figure>


<p>This approach obviously will not work as is, so we will instead link each library conditionally based on the <em>mock</em> build take that we will define:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='go'><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm">#include &lt;libspotify/api.h&gt;</span>
</span><span class='line'><span class="cm">#cgo mock LDFLAGS: -lmockspotify.2</span>
</span><span class='line'><span class="cm">#cgo !mock LDFLAGS: -lspotify.12</span>
</span><span class='line'><span class="cm">*/</span>
</span></code></pre></td></tr></table></div></figure>


<p>This will link libmockspotify when the <em>mock</em> build tag is defined, otherwise we will use the real libspotify. So then how do we define build tags? Simple:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>go run -tags mock myfile.go
</span></code></pre></td></tr></table></div></figure>


<p>Thats enough for today, have fun with build tags! I will leave you with one more pro tip!</p>

<p>In my <code>~/.vim</code> folder I have a ftplugin for Go that includes a binding for running tests:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>nmap &lt;Leader&gt;t :!go test -tags test &lt;cr&gt;
</span></code></pre></td></tr></table></div></figure>


<p>You see how I include the <em>test</em> tag in all of my test running? This makes it convenient when linking mock libraries specific for running tests!</p>

<p>Until next time!</p>

      
      
    </div>
  </div>



    </article>
    
    <hr>
    
  
  
    <article>
      

  <div class="row-fluid">
    <div class="span2">
		<h1 class="date-time">








  


<i class="icon-calendar-empty"></i> <time datetime="2013-07-08T06:40:00-07:00" pubdate data-updated="true">Jul 8<span>th</span>, 2013</time></h5>
          <div class="row-fluid">
          
          <a href="http://codegangsta.io/blog/2013/07/08/c-bindings-in-go-a-practical-example/#disqus_thread">Comments </a> <span class="fui-bubble-16"></span>
          
          </div>
          
          <div class="row-fluid">
          
          <a href="/blog/categories/cgo/"><span class="badge">cgo</span></a>
          
          <a href="/blog/categories/go/"><span class="badge">go</span></a>
          
          <a href="/blog/categories/golang/"><span class="badge">golang</span></a>
          
          <a href="/blog/categories/libmockspotify/"><span class="badge">libmockspotify</span></a>
          
          <a href="/blog/categories/libspotify/"><span class="badge">libspotify</span></a>
          
          <a href="/blog/categories/practicalgo/"><span class="badge">practicalgo</span></a>
          
          <a href="/blog/categories/spotify/"><span class="badge">spotify</span></a>
          
          </div>
          
    </div>
    <div class="span10">
      <h1 class="link"><a href="/blog/2013/07/08/c-bindings-in-go-a-practical-example/">Practical Go: C Bindings</a></h1>
      <p>I have been playing with <a href="http://golang.org/">Go</a> lately. The language itself has a lot going for it, one of which is a decent set of interop with existing C code. Today I am going to walk you through a practical example of how this is done by showing some code that I have been working on lately with Go.</p>

<h2>The Simplest Hello World</h2>

<p>Assuming you have your <a href="http://golang.org/doc/code.html">Go development environment all set up,</a> go ahead and create a new go file with the following contents:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='go'><span class='line'><span class="kn">package</span> <span class="nx">main</span>
</span><span class='line'>
</span><span class='line'><span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nb">println</span><span class="p">(</span><span class="s">&quot;Hello world&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Running this should obviously print &#8220;Hello world&#8221;. Let&#8217;s move on!</p>

<h2>Using libspotify</h2>

<p>Lets start creating some C bindings for libspotify! libspotify is a C api distributed by Spotify that basically allows us to do everything a typical spotify app can do; log in, play, music, manipulate playlists - all available to us with libspotify.</p>

<p>For the sake of keeping this post short and to the point, we will just be creating a <code>sp_session</code> object. This session will lay some groundwork for us to log in and do the fun stuff libspotify allows us to do. Why don&#8217;t we dive in:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='go'><span class='line'><span class="kn">package</span> <span class="nx">main</span>
</span><span class='line'>
</span><span class='line'><span class="kd">type</span> <span class="nx">Session</span> <span class="kd">struct</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">session</span> <span class="o">*</span><span class="nx">C</span><span class="p">.</span><span class="nx">sp_session</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nb">println</span><span class="p">(</span><span class="s">&quot;Hello world&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Running this will result in an error</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>./bindings.go:4: undefined: C
</span></code></pre></td></tr></table></div></figure>


<p>This is because we actually need to use some special magic that Go provides for us, the C package.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='go'><span class='line'><span class="kn">package</span> <span class="nx">main</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="s">&quot;C&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">type</span> <span class="nx">Session</span> <span class="kd">struct</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">session</span> <span class="o">*</span><span class="nx">C</span><span class="p">.</span><span class="nx">sp_session</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nb">println</span><span class="p">(</span><span class="s">&quot;Hello world&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This gives us a different error:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>error: &#39;sp_session&#39; undeclared (first use in this function)
</span><span class='line'>error: (Each undeclared identifier is reported only once
</span></code></pre></td></tr></table></div></figure>


<p>Cool, so it sees the C package, but sp_session doesn&#8217;t exist. This is because we need to include libspotify using the <code>#include</code> directive for the C preprocessor. First make sure you have libspotify installed. On a Mac you can run <code>brew install libspotify</code>. Now try to run the following code:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='go'><span class='line'><span class="kn">package</span> <span class="nx">main</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm">#include &lt;libspotify/api.h&gt;</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="kn">import</span> <span class="s">&quot;C&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">type</span> <span class="nx">Session</span> <span class="kd">struct</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">session</span> <span class="o">*</span><span class="nx">C</span><span class="p">.</span><span class="nx">sp_session</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nb">println</span><span class="p">(</span><span class="s">&quot;Hello world&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This should compile and run since <code>sp_session</code> now resides in the global C namespace! This works great for things that exist in the header, but it breaks down when we try to initialize our session:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='go'><span class='line'><span class="kn">package</span> <span class="nx">main</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm">#include &lt;libspotify/api.h&gt;</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="kn">import</span> <span class="s">&quot;C&quot;</span>
</span><span class='line'><span class="kn">import</span> <span class="s">&quot;unsafe&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">type</span> <span class="nx">Session</span> <span class="kd">struct</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">session</span> <span class="o">*</span><span class="nx">C</span><span class="p">.</span><span class="nx">sp_session</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">key</span> <span class="o">:=</span> <span class="s">&quot;appkey_good&quot;</span>
</span><span class='line'>  <span class="nx">session</span> <span class="o">:=</span> <span class="nx">Session</span><span class="p">{}</span>
</span><span class='line'>  <span class="nx">appkey</span> <span class="o">:=</span> <span class="nx">C</span><span class="p">.</span><span class="nx">CString</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span>
</span><span class='line'>  <span class="nx">appkey_size</span> <span class="o">:=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">config</span> <span class="p">=</span> <span class="nx">C</span><span class="p">.</span><span class="nx">sp_session_config</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">api_version</span><span class="p">:</span>          <span class="nx">C</span><span class="p">.</span><span class="nx">SPOTIFY_API_VERSION</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">cache_location</span><span class="p">:</span>       <span class="nx">C</span><span class="p">.</span><span class="nx">CString</span><span class="p">(</span><span class="s">&quot;.spotify/&quot;</span><span class="p">),</span>
</span><span class='line'>    <span class="nx">settings_location</span><span class="p">:</span>    <span class="nx">C</span><span class="p">.</span><span class="nx">CString</span><span class="p">(</span><span class="s">&quot;.spotify/&quot;</span><span class="p">),</span>
</span><span class='line'>    <span class="nx">user_agent</span><span class="p">:</span>           <span class="nx">C</span><span class="p">.</span><span class="nx">CString</span><span class="p">(</span><span class="s">&quot;spotify for go&quot;</span><span class="p">),</span>
</span><span class='line'>    <span class="nx">application_key</span><span class="p">:</span>      <span class="nx">unsafe</span><span class="p">.</span><span class="nx">Pointer</span><span class="p">(</span><span class="nx">appkey</span><span class="p">),</span>
</span><span class='line'>    <span class="nx">application_key_size</span><span class="p">:</span> <span class="nx">C</span><span class="p">.</span><span class="nx">size_t</span><span class="p">(</span><span class="nx">appkey_size</span><span class="p">)}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">C</span><span class="p">.</span><span class="nx">sp_session_create</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">config</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">session</span><span class="p">.</span><span class="nx">session</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Will result in the following error:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>Undefined symbols for architecture x86_64:
</span><span class='line'>  &quot;_sp_session_create&quot;, referenced from:
</span><span class='line'>      __cgo_90280c6a3021_Cfunc_sp_session_create in bindings.cgo2.o
</span><span class='line'>     (maybe you meant: __cgo_90280c6a3021_Cfunc_sp_session_create)
</span><span class='line'>ld: symbol(s) not found for architecture x86_64
</span><span class='line'>collect2: ld returned 1 exit status
</span></code></pre></td></tr></table></div></figure>


<p>This is because we didn&#8217;t link libspotify. This is an easy fix, add this in the comment above <code>import "C"</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>#cgo LDFLAGS: -lspotify.12
</span></code></pre></td></tr></table></div></figure>


<p>Your code should compile and link fine. You will get a SIGSEGV in your application, this is becuase we specified a bogus app key. We will cover this in detail during Part 2 of <em>C Bindings in Go: A Practical Example</em>.</p>

<p>Until next time!</p>

      
      
    </div>
  </div>



    </article>
    
    <hr>
    
  
  
    <article>
      

  <div class="row-fluid">
    <div class="span2">
		<h1 class="date-time">








  


<i class="icon-calendar-empty"></i> <time datetime="2013-04-04T08:26:00-07:00" pubdate data-updated="true">Apr 4<span>th</span>, 2013</time></h5>
          <div class="row-fluid">
          
          <a href="http://codegangsta.io/blog/2013/04/04/dependency-injection-in-ruby/#disqus_thread">Comments </a> <span class="fui-bubble-16"></span>
          
          </div>
          
          <div class="row-fluid">
          
          </div>
          
    </div>
    <div class="span10">
      <h1 class="link"><a href="/blog/2013/04/04/dependency-injection-in-ruby/">Dependency Injection in Ruby</a></h1>
      <p>Dynamically typed languages like Ruby are an interesting beast when it comes to dependency injection. The topic itself has been debated in the Ruby community every once in a while:</p>

<blockquote class="twitter-tweet"><p>Dependency injection is not a virtue in Ruby <a href="http://t.co/4w2qSCfo" title="http://bit.ly/ZtzSz9">bit.ly/ZtzSz9</a>, and then there&#8217;s the immediate criticism: <a href="http://t.co/Q1O9TvGm" title="http://bit.ly/ZtzQHw">bit.ly/ZtzQHw</a></p>&mdash; Nicola Iarocci (@nicolaiarocci) <a href="https://twitter.com/nicolaiarocci/status/288215967622914048">January 7, 2013</a></blockquote>


<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>


<p>Let me start off by first saying that dependency injection is not a catch-all for managing dependencies in Ruby. There are many other ways to abstract hard dependencies within your code. Today I want to specifically talk about programming to interfaces in Ruby and how to solve the “dependencies” problem in that space.</p>

<h2>Programming to Interfaces</h2>

<p>A common argument is that Ruby does not need dependency injection because Module mixins exist in the language. Module mixins surely allow implementation details to be abstracted and shared so that change can happen mostly in one place. A Ruby developer must think of the intensions of the Class/Implementation they are composing to correctly identify the solution to managing dependencies.</p>

<h2>The Module Approach</h2>

<p>Modules provide a clean solution to resolving dependencies, the basic premise looks like this:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">Downloadable</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">download</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span class='line'>    <span class="c1"># download the url and location</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">SDK</span>
</span><span class='line'>  <span class="kp">include</span> <span class="no">Downloadable</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">install</span>
</span><span class='line'>    <span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span class='line'>    <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is a great example of how module mixins can be an excellent solution to our problem. <code>Downloadable</code> is completely reusable and can be safely mixed into any other class we want.</p>

<h3>The Danger</h3>

<p>The dangerous part about all of this is the <em>abuse</em> cases with mixins. When we type:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="kp">include</span> <span class="no">Downloadable</span>
</span></code></pre></td></tr></table></div></figure>


<p>We are essentially allowing the <code>Downloadable</code> module to add any number of methods it desires to our class. This pattern can easily veer codebases out of control if it is not monitored properly, so it is not quite a <em>silver bullet</em> for dependency resolution in Ruby.</p>

<h2>The attr_inject Approach</h2>

<p>Finding out the Modules was a solution to a particular problem and not an solution to the entire problem space encouraged me to go out an write a elegant and Rubyesque dependency injection framework. I call it <a href="https://github.com/jeremysaenz/attr_inject">attr_inject</a>.</p>

<p>Before I go into details I want to spend a little time sharing what I think is a great explanation of the problem we are seeking to solve:</p>

<blockquote><p>Using dependency injection to shape code relies on your ability to recognize that the responsibility for knowing the name of a class and the responsibility for knowing the name of a message to send to that class may belong in different objects. -Sandi Metz. Practical Object-Oriented Design in Ruby</p></blockquote>

<p>I love this statement because it essentially says that when I explicitly want to inject something I have to stop thinking of the dependency as a class and start thinking of it as an interface. For instance:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">User</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">name</span>
</span><span class='line'>    <span class="s2">&quot;foobar&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">age</span>
</span><span class='line'>    <span class="mi">22</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Project</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@user</span> <span class="o">=</span> <span class="n">user</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">username</span>
</span><span class='line'>    <span class="vi">@user</span><span class="o">.</span><span class="n">name</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>As far as <code>Project</code> is concerned, <code>@user</code> is an object that responds to the <code>name</code> message. This makes dependency injection shine when  used properly.</p>

<h3>Flexible DI</h3>

<p>In <em>Practical Object-Oriented Design in Ruby</em>, Sandi walks the reader through a real world example, progressively improving how dependencies are managed through injection. Here is a sample of the ultimate solution:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span class='line'>  <span class="vi">@foo</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="ss">:foo</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
</span><span class='line'>  <span class="vi">@bar</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="ss">:bar</span><span class="p">,</span> <span class="mi">18</span><span class="p">)</span>
</span><span class='line'>  <span class="vi">@baz</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="ss">:baz</span><span class="o">]</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Injecting through the constructor with a hash provides immense flexibility and allows the class to not care about the Module or Class name of the dependency. It also solves the problem of <em>argument order dependencies</em>.</p>

<h3>One Step Further</h3>

<p>The <a href="https://github.com/jeremysaenz/attr_inject">attr_inject</a> gem takes this pattern one step further. Examine the code below:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">Project</span>
</span><span class='line'>  <span class="n">attr_inject</span> <span class="ss">:user</span>
</span><span class='line'>  <span class="n">attr_inject</span> <span class="ss">:sdk</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span class='line'>    <span class="n">inject_attributes</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>This snippet of code injects the <code>args</code> hash into the <code>Project</code>’s <code>user</code> and <code>sdk</code> attributes. If the <code>user</code> and <code>sdk</code> attributes do not exist, <code>inject_attributes</code> will throw an exception by default. This of course can be configured:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">attr_inject</span> <span class="ss">:user</span><span class="p">,</span> <span class="ss">:required</span> <span class="o">=&gt;</span> <span class="kp">false</span>
</span></code></pre></td></tr></table></div></figure>


<p>or</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">attr_inject</span> <span class="ss">:user</span><span class="p">,</span> <span class="n">default</span> <span class="o">=&gt;</span> <span class="n">some_default</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Even Further&#8230;</h3>

<p>If you are like me and you don’t always want to pass arguments into the object initializer or you want to inject dependencies whenever you want, you can use the <code>Injector</code> class.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Main</span>
</span><span class='line'>  <span class="kp">include</span> <span class="no">Inject</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">()</span>
</span><span class='line'>    <span class="n">injector</span> <span class="o">=</span> <span class="no">Injector</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>    <span class="n">injector</span><span class="o">.</span><span class="n">map</span> <span class="ss">:user</span><span class="p">,</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>    <span class="n">injector</span><span class="o">.</span><span class="n">map</span> <span class="ss">:sdk</span><span class="p">,</span> <span class="no">SDK</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">injector</span><span class="o">.</span><span class="n">apply</span> <span class="no">Project</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Project</span>
</span><span class='line'>  <span class="n">attr_inject</span> <span class="ss">:user</span>
</span><span class='line'>  <span class="n">attr_inject</span> <span class="ss">:sdk</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Factories</h3>

<p>Sometimes the dependency would like to know some information about the object it is injected into, or the dependency needs to be created specially for each injection. This is where factories come into play.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">injector</span> <span class="o">=</span> <span class="no">Injector</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'><span class="n">injector</span><span class="o">.</span><span class="n">factory</span> <span class="ss">:logger</span> <span class="k">do</span> <span class="o">|</span><span class="n">target</span><span class="o">|</span>
</span><span class='line'>  <span class="no">Logger</span><span class="o">.</span><span class="n">new</span> <span class="n">target</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Our logger object will be created upon every injection. You can request the logger object on your class the same way as any other dependency:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">attr_inject</span> <span class="ss">:logger</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Conclusion</h2>

<p><a href="https://github.com/jeremysaenz/attr_inject">attr_inject</a> is an elegant and scalable way to manage dependencies. Documentation is a bit sparse at the moment and I hope to get a tutorial up and going very soon. Please feel free to fork it on Github an play around with it. Let me know what you think!</p>

      
      
    </div>
  </div>



    </article>
    
    <hr>
    
  
  
    <article>
      

  <div class="row-fluid">
    <div class="span2">
		<h1 class="date-time">








  


<i class="icon-calendar-empty"></i> <time datetime="2013-04-03T18:33:00-07:00" pubdate data-updated="true">Apr 3<span>rd</span>, 2013</time></h5>
          <div class="row-fluid">
          
          <a href="http://codegangsta.io/blog/2013/04/03/a-warm-welcome-from-the-code-gangsta/#disqus_thread">Comments </a> <span class="fui-bubble-16"></span>
          
          </div>
          
          <div class="row-fluid">
          
          </div>
          
    </div>
    <div class="span10">
      <h1 class="link"><a href="/blog/2013/04/03/a-warm-welcome-from-the-code-gangsta/">A Warm Welcome from the Code Gangsta</a></h1>
      <p>The day finally has arrived. I am starting a blog.</p>

<h2>Introduction</h2>

<p>For those of you who do not know me, my name is Jeremy Saenz. I have been building software since graduating high school. Discovering that I did not want to attend college, I naturally picked up software engineering as a passionate craft that I care deeply about.</p>

<p>Back in 2008 I was just starting to wade (drown perhaps is the better word) through the vast sea of knowledge that is the software engineering industry. I began my journey by programming Adobe Flex apps with Actionscript 3. To ease the pain of entering an industry completely void of prior relationships and contacts, I decided to create a gangsta-rap video that was related to tech (Flex specifically).</p>

<p>Thus, the Flex Gangsta was born!</p>

<iframe width="420" height="315" src="http://www.youtube.com/embed/k76KH-MxdAI" frameborder="0" allowfullscreen></iframe>


<h2>The Flex Gangsta</h2>

<p>The video instantly propelled me into the industry. In all humbleness and honesty it was a scary time for me. I was gracefully accepted into as a community member when I did not <em>really</em> know how to write code!</p>

<p>With the help of some wonderful mentors I eventually <em>did</em> learn how to write code, and write it well. I began speaking at conferences and continued to produce rap songs and videos for the fun of it.</p>

<iframe width="420" height="315" src="http://www.youtube.com/embed/DJ001Kgz5wc" frameborder="0" allowfullscreen></iframe>


<h2>Recently&#8230;</h2>

<p>The last couple years yielded an abundance of knowledge and experience, ranging from building key modules for a large social game to designing and implementing a full fledged driving game that is deployed/featured at auto shows across the country.</p>

<p>My more recent endeavor (~1yr) has been working with the fantastic team over at <a href="http://theengine.co/">The Engine Co.</a> The team has been tirelessly working to deliver a rapid and pragmatic workflow/platform for developing cross-platform mobile games. Loom, our flagship product, has recently launched and is building a strong community of developers dedicated to make this platform a lasting value to the mobile games industry.</p>

<p>At The Engine Co. our driving philosophy is to use the best tool for the job. Building a tooling workflow and development platform requires us to touch Java, Obj-C, C, C++, Ruby, C#, and LoomScript (our homegrown language) to get the job done right.</p>

<p>Today I am touching many different technologies, and thus I change my alias from the <strong>Flex Gangsta</strong> to <strong>Code Gangsta</strong>. The purpose of this blog is to document some solutions I discover in my day to day.</p>

<p>Thanks for joining me on this adventure, now let&#8217;s write some software!</p>

      
      
    </div>
  </div>



    </article>
    
  
  <div class="pagination">
    

    
  </div>
</div>


        </div>
      </div>
      <div class="row-fluid">
        <footer class="footer-page" role="contentinfo">
          <p>
  Copyright &copy; 2013 - Jeremy -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span> - Theme by <a href="http://alexgaribay.com">Alex Garibay</a>
</p>


        </footer>
      </div>
    </div>
  </div>
  

<script type="text/javascript">
      var disqus_shortname = 'codegangsta';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
